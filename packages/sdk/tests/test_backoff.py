import random

from itly_sdk.internal import backoff


def test_backoff():
    items = list(backoff(start=10, stop=100000, count=20, jitter=0))
    assert items == [10.0, 20.0, 40.0, 80.0, 160.0, 320.0, 640.0, 1280.0, 2560.0, 5120.0,
                     10240.0, 20480.0, 40960.0, 81920.0, 100000.0, 100000.0, 100000.0, 100000.0, 100000.0, 100000.0]


def test_backoff_jitter():
    random.seed(100)
    items = list(backoff(start=10, stop=100000, count=20, jitter=1))
    assert items == [8.543307448958696, 10.901459909719573, 9.168647773639115, 23.558941845277765, 42.88656431467908,
                     181.2753808334708, 127.98690743460622, 597.8861892575087, 2354.806504503035, 2785.557088340136,
                     9749.631831450197, 1372.9300464629669, 2167.684874119419, 54448.064434994376, 69059.40708599659,
                     23198.18512549196, 79613.0471223143, 82153.92370460088, 81140.50858255145, 65299.554638518275]
